<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a2f8f" />
  <title>Thunjai Express — Sender</title>
  <style>
    :root{
      --brand:#ffd54d;            /* Thunder yellow */
      --brand-blue:#0a2f8f;       /* Deep royal blue */
      --brand-soft:#fff6cc;       /* Pale yellow bg */
      --ink:#0b2b27;              /* Body text */
      --bg:#ffffff;               /* Page background (white as requested) */
      --muted:#64748b;            /* Secondary text */
      --line:#e5e7eb;             /* Divider */
      --radius:18px;              /* Card radius */
      --hdr:56px;                 /* Header height */
      --bnv:64px;                 /* Bottom nav height */
      --maxw:520px;               /* content width */
      --shadow:0 6px 20px rgba(2,12,27,.08),0 2px 6px rgba(2,12,27,.06);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans Thai',sans-serif;
      color:var(--ink); background:var(--bg); -webkit-font-smoothing:antialiased; line-height:1.35;
    }

    .app{min-height:100%; display:flex; flex-direction:column; align-items:center;}
    .wrap{width:100%; max-width:var(--maxw); padding:0 16px;}

    /* Header */
    header{
      position:sticky; top:0; z-index:20; height:var(--hdr);
      backdrop-filter:saturate(180%) blur(10px);
      background:linear-gradient(to bottom, rgba(255,255,255,.95), rgba(255,255,255,.75));
      border-bottom:1px solid var(--line);
    }
    .hdr{height:var(--hdr); display:flex; align-items:center; gap:12px;}
    .logo{display:inline-flex; align-items:center; gap:10px; text-decoration:none; color:inherit}
    .logo svg{width:28px; height:28px}
    .brand-title{font-weight:700}
    .hdr-actions{margin-left:auto; display:flex; gap:8px}

    /* Cards */
    .card{background:#fff; border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);}
    .card + .card{margin-top:16px}
    .card-h{display:flex; align-items:flex-end; justify-content:space-between; padding:16px 16px 0;}
    .card-h h2{margin:0; font-size:18px}
    .card-b{padding:16px}

    /* Dashboard pills */
    .metrics{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .metric{background:var(--brand-soft); border:1px dashed rgba(10,47,143,.15); border-radius:14px; padding:12px;}
    .metric small{display:block; color:var(--muted)}
    .metric strong{display:block; font-size:22px; margin-top:6px}

    /* Buttons */
    .btn{appearance:none; border:none; border-radius:14px; padding:12px 14px; font-weight:600; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .btn-primary{background:var(--brand-blue); color:#fff}
    .btn-ghost{background:transparent; border:1px solid var(--line)}
    .btn-warning{background:var(--brand); color:#111}
    .btn-icon{display:inline-flex; align-items:center; gap:8px}

    /* Form */
    .grid{display:grid; gap:12px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    label{display:block; font-weight:600; margin-bottom:6px}
    .req{color:#b42318}
    input[type="text"], input[type="tel"], input[type="number"], input[type="datetime-local"], textarea{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--line); background:#fff; color:inherit;
    }
    textarea{min-height:92px; resize:vertical}
    .field-note{color:var(--muted); font-size:12px; margin-top:6px}
    .row{display:flex; gap:10px; align-items:center}

    /* Switch */
    .switch{position:relative; width:46px; height:26px}
    .switch input{opacity:0; width:0; height:0}
    .slider{position:absolute; inset:0; background:#e5e7eb; border-radius:26px; transition:.2s}
    .slider:before{content:""; position:absolute; width:22px; height:22px; left:2px; top:2px; background:#fff; border-radius:50%; box-shadow:0 1px 2px rgba(0,0,0,.15); transition:.2s}
    .switch input:checked + .slider{background:var(--brand-blue)}
    .switch input:checked + .slider:before{transform:translateX(20px)}

    /* Image upload preview */
    .upload{display:flex; gap:12px; align-items:center}
    .preview{width:72px; height:72px; border-radius:14px; background:#f1f5f9; border:1px dashed #cbd5e1; display:flex; align-items:center; justify-content:center; overflow:hidden}
    .preview img{width:100%; height:100%; object-fit:cover}

    /* Toast */
    .toast{position:fixed; left:50%; bottom:calc(var(--bnv) + env(safe-area-inset-bottom) + 16px); transform:translateX(-50%);
      background:#111; color:#fff; padding:12px 14px; border-radius:12px; font-weight:600; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:.25s}
    .toast.show{opacity:1}

    /* Bottom Navigation */
    nav{
      position:sticky; bottom:0; z-index:30;
      padding-bottom:calc(env(safe-area-inset-bottom));
      background:rgba(255,255,255,.98); border-top:1px solid var(--line); height:var(--bnv);
      backdrop-filter:saturate(180%) blur(10px);
    }
    .bnv{height:var(--bnv); display:grid; grid-template-columns:repeat(3,1fr); gap:6px; align-items:center}
    .tab{height:44px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; border-radius:12px; color:#0b2b27; text-decoration:none}
    .tab svg{width:20px; height:20px}
    .tab.active{background:var(--brand-soft);}

    /* Helper */
    .muted{color:var(--muted)}
    .spacer{height:10px}

    @media (prefers-color-scheme: dark){
      :root{--bg:#0b1220; --ink:#e5e7eb; --line:#1f2937;}
      body{background:var(--bg)}
      header{background:linear-gradient(to bottom, rgba(17,24,39,.8), rgba(17,24,39,.6)); border-bottom-color:var(--line)}
      .card{background:#111827; border-color:var(--line)}
      input,textarea{background:#0f172a; color:#e5e7eb; border-color:#25324a}
      .btn-ghost{border-color:#25324a; color:#e5e7eb}
      nav{background:rgba(17,24,39,.9); border-top-color:var(--line)}
      .tab{color:#e5e7eb}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="wrap hdr">
      <a class="logo" href="home.html" aria-label="กลับหน้าแรก">
        <!-- Inline SVG lightning bolt as brand mark -->
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13 2 3 14h7l-1 8 12-14h-7l-1-6z" fill="var(--brand-blue)" stroke="var(--brand-blue)" stroke-linejoin="round"/>
          <path d="M11 2 2 12h7l-1 8 11-13h-7l-1-7z" fill="var(--brand)"/>
        </svg>
        <span class="brand-title">THUNJAI EXPRESS — Sender</span>
      </a>
      <div class="hdr-actions">
        <button class="btn btn-ghost btn-icon" id="btnDraft" title="บันทึกเป็นฉบับร่าง">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5"/><path d="M7 3h14v14"/><path d="m21 3-9 9"/></svg>
          Draft
        </button>
      </div>
    </div>
  </header>

  <main class="wrap" style="padding:16px 16px calc(var(--bnv) + 24px)">

    <!-- Dashboard -->
    <section class="card" aria-labelledby="dashTitle">
      <div class="card-h">
        <h2 id="dashTitle">สรุปวันนี้</h2>
        <button class="btn btn-warning btn-icon" id="btnNewTop">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
          สร้างออเดอร์
        </button>
      </div>
      <div class="card-b">
        <div class="metrics">
          <div class="metric"><small>ยอดออเดอร์วันนี้</small><strong id="mOrders">0</strong></div>
          <div class="metric"><small>COD คงเหลือ</small><strong id="mCOD">฿0</strong></div>
        </div>
      </div>
    </section>

    <!-- Create Order -->
    <section class="card" aria-labelledby="formTitle" id="createOrder">
      <div class="card-h"><h2 id="formTitle">สร้างออเดอร์</h2></div>
      <div class="card-b">
        <form id="orderForm" class="grid" novalidate>
          <div>
            <label for="recipient">ชื่อผู้รับ <span class="req">*</span></label>
            <input id="recipient" name="recipient" type="text" autocomplete="name" required placeholder="เช่น คุณสมชาย ใจดี" />
          </div>
          <div>
            <label for="phone">เบอร์โทร <span class="req">*</span></label>
            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="0XXXXXXXXX" pattern="^0\d{8,9}$" required />
            <div class="field-note">กรอกเฉพาะตัวเลข 9–10 หลัก เริ่มด้วย 0</div>
          </div>
          <div>
            <label for="address">ที่อยู่จัดส่ง <span class="req">*</span></label>
            <textarea id="address" name="address" required placeholder="บ้านเลขที่/ถนน/ตำบล/อำเภอ/จังหวัด/รหัสไปรษณีย์"></textarea>
          </div>

          <div class="grid cols-2">
            <div>
              <label for="lat">พิกัด (Lat)</label>
              <input id="lat" name="lat" type="text" inputmode="decimal" placeholder="เช่น 13.7563" />
            </div>
            <div>
              <label for="lng">พิกัด (Lng)</label>
              <input id="lng" name="lng" type="text" inputmode="decimal" placeholder="เช่น 100.5018" />
            </div>
          </div>
          <div class="row">
            <button type="button" class="btn btn-ghost btn-icon" id="btnLocate">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m20 12 2 0"/><path d="M2 12h2"/></svg>
              ใช้ตำแหน่งปัจจุบัน
            </button>
            <button type="button" class="btn btn-ghost btn-icon" id="btnOpenMap">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 6 6-2 6 2 6-2v14l-6 2-6-2-6 2z"/><path d="M9 4v16"/><path d="M15 6v16"/></svg>
              เปิดแผนที่
            </button>
          </div>

          <hr style="border:none; border-top:1px solid var(--line); margin:6px 0 4px" />

          <div class="grid cols-2">
            <div>
              <label for="size">ขนาดพัสดุ (กxยxส ซม.)</label>
              <input id="size" name="size" type="text" placeholder="เช่น 20x30x15" />
            </div>
            <div>
              <label for="weight">น้ำหนัก (กก.)</label>
              <input id="weight" name="weight" type="number" step="0.01" min="0" placeholder="เช่น 1.25" />
            </div>
          </div>

          <div>
            <label for="note">รายละเอียดเพิ่มเติม</label>
            <textarea id="note" name="note" placeholder="เช่น ของแตกง่าย กรุณาระวัง"></textarea>
          </div>

          <div>
            <label>แนบรูปพัสดุ</label>
            <div class="upload">
              <div class="preview" id="preview"><span class="muted">ไม่มีรูป</span></div>
              <input id="photo" name="photo" type="file" accept="image/*" />
            </div>
          </div>

          <div class="grid cols-2" style="align-items:center">
            <div class="row" style="justify-content:flex-start">
              <label class="row" style="gap:10px">
                <span>ด่วน</span>
                <span class="switch">
                  <input type="checkbox" id="urgent" name="urgent" />
                  <span class="slider"></span>
                </span>
              </label>
            </div>
            <div class="row" style="justify-content:flex-end">
              <label class="row" style="gap:10px">
                <span>จองล่วงหน้า</span>
                <span class="switch">
                  <input type="checkbox" id="reserve" name="reserve" />
                  <span class="slider"></span>
                </span>
              </label>
            </div>
          </div>

          <div id="reserveFields" style="display:none">
            <div class="grid cols-2">
              <div>
                <label for="reserveAt">วัน‑เวลา รับพัสดุ</label>
                <input id="reserveAt" type="datetime-local" />
              </div>
              <div>
                <label for="reserveNote">หมายเหตุการนัด</label>
                <input id="reserveNote" type="text" placeholder="เช่น หลัง 18:00 น." />
              </div>
            </div>
          </div>

          <div class="row" style="justify-content:space-between; margin-top:6px">
            <button type="reset" class="btn btn-ghost">ล้างฟอร์ม</button>
            <button type="submit" class="btn btn-primary btn-icon" id="btnSubmit">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2 11 13"/><path d="M22 2 15 22 11 13 2 9z"/></svg>
              บันทึกออเดอร์
            </button>
          </div>
        </form>
      </div>
    </section>

    <div class="spacer"></div>
  </main>

  <!-- Bottom Navigation -->
  <nav>
    <div class="wrap bnv">
      <a class="tab active" href="#sender" aria-current="page" title="Sender">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="m3 7 9 6 9-6"/></svg>
        <small>Sender</small>
      </a>
      <a class="tab" href="#tracking" id="goTracking" title="Tracking">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        <small>Tracking</small>
      </a>
      <a class="tab" href="#cod" id="goCOD" title="ถอนเงิน COD">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M12 12h0"/><path d="M6 12h0"/><path d="M18 12h0"/></svg>
        <small>COD</small>
      </a>
    </div>
  </nav>
</div>

<div class="toast" id="toast">บันทึกออเดอร์แล้ว</div>

<script>
  // Dashboard demo data
  const mOrders = document.getElementById('mOrders');
  const mCOD = document.getElementById('mCOD');
  const todayKey = new Date().toISOString().slice(0,10);
  const dash = JSON.parse(localStorage.getItem('senderDash')||'{}');
  if(!dash[todayKey]) dash[todayKey] = {orders:0, cod:0};
  function refreshDash(){
    mOrders.textContent = dash[todayKey].orders;
    mCOD.textContent = new Intl.NumberFormat('th-TH',{style:'currency',currency:'THB'}).format(dash[todayKey].cod||0);
    localStorage.setItem('senderDash', JSON.stringify(dash));
  }
  refreshDash();

  // Reserve toggle
  const reserve = document.getElementById('reserve');
  const reserveFields = document.getElementById('reserveFields');
  reserve.addEventListener('change',()=>{
    reserveFields.style.display = reserve.checked ? 'block' : 'none';
  });

  // Photo preview
  const photo = document.getElementById('photo');
  const preview = document.getElementById('preview');
  photo.addEventListener('change', (e)=>{
    const f = e.target.files?.[0];
    if(!f){ preview.innerHTML = '<span class="muted">ไม่มีรูป</span>'; return }
    const url = URL.createObjectURL(f);
    preview.innerHTML = `<img alt="แนบรูปพัสดุ" src="${url}">`;
  });

  // Locate current position
  const btnLocate = document.getElementById('btnLocate');
  const lat = document.getElementById('lat');
  const lng = document.getElementById('lng');
  btnLocate.addEventListener('click', ()=>{
    if(!('geolocation' in navigator)) return alert('อุปกรณ์ไม่รองรับการระบุตำแหน่ง');
    btnLocate.disabled = true;
    navigator.geolocation.getCurrentPosition((pos)=>{
      lat.value = pos.coords.latitude.toFixed(6);
      lng.value = pos.coords.longitude.toFixed(6);
      btnLocate.disabled = false;
    },(err)=>{
      alert('ไม่สามารถเข้าถึงตำแหน่ง: '+ err.message);
      btnLocate.disabled = false;
    },{enableHighAccuracy:true, timeout:10000});
  });

  // Open map with lat/lng
  document.getElementById('btnOpenMap').addEventListener('click', ()=>{
    const la = lat.value.trim();
    const ln = lng.value.trim();
    if(!la || !ln) return alert('กรอกพิกัดก่อน (Lat/Lng) หรือกด ใช้ตำแหน่งปัจจุบัน');
    const q = encodeURIComponent(`${la},${ln}`);
    const url = `https://maps.google.com/?q=${q}`;
    window.open(url, '_blank');
  });

  // Save Draft (localStorage)
  const form = document.getElementById('orderForm');
  const draftKey = 'senderDraft';
  document.getElementById('btnDraft').addEventListener('click', ()=>{
    const data = Object.fromEntries(new FormData(form).entries());
    localStorage.setItem(draftKey, JSON.stringify(data));
    toast('บันทึกเป็นฉบับร่างแล้ว');
  });
  // Load draft on start
  try{
    const d = JSON.parse(localStorage.getItem(draftKey)||'null');
    if(d){
      for(const k in d){ if(form[k]) form[k].value = d[k]; }
      if(d.reserve === 'on'){ reserve.checked = true; reserve.dispatchEvent(new Event('change')); }
    }
  }catch{}

  // Form submit
  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const btn = document.getElementById('btnSubmit');
    btn.disabled = true;

    // Basic validation
    const recip = document.getElementById('recipient');
    const phone = document.getElementById('phone');
    const addr = document.getElementById('address');

    let ok = true;
    [recip,phone,addr].forEach(el=>{ el.style.borderColor = 'var(--line)'; });

    if(!recip.value.trim()) { recip.style.borderColor = '#ef4444'; ok=false; }
    if(!/^0\d{8,9}$/.test(phone.value.trim())) { phone.style.borderColor = '#ef4444'; ok=false; }
    if(!addr.value.trim()) { addr.style.borderColor = '#ef4444'; ok=false; }

    if(!ok){ btn.disabled = false; return toast('กรอกข้อมูลให้ครบถ้วน'); }

    // Compose order object (no backend: demo only)
    const data = Object.fromEntries(new FormData(form).entries());
    data.createdAt = new Date().toISOString();
    data.id = 'S' + Math.random().toString(36).slice(2,8).toUpperCase();

    // Persist locally for demo
    const orders = JSON.parse(localStorage.getItem('senderOrders')||'[]');
    orders.unshift(data);
    localStorage.setItem('senderOrders', JSON.stringify(orders));

    // Update dashboard counters
    dash[todayKey].orders += 1;
    refreshDash();

    // Clear draft & reset form (keep photo state)
    localStorage.removeItem(draftKey);
    form.reset();
    preview.innerHTML = '<span class="muted">ไม่มีรูป</span>';
    reserve.checked = false; reserve.dispatchEvent(new Event('change'));

    toast('บันทึกออเดอร์แล้ว #' + data.id);
    btn.disabled = false;
  });

  // Top create button scrolls to form
  document.getElementById('btnNewTop').addEventListener('click', ()=>{
    document.getElementById('createOrder').scrollIntoView({behavior:'smooth', block:'start'});
  });

  // Tiny toast
  const toastEl = document.getElementById('toast');
  let toastTimer = null;
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toastEl.classList.remove('show'), 2000);
  }

  // Demo links (replace with actual pages/routes)
  document.getElementById('goTracking').addEventListener('click', (e)=>{
    e.preventDefault(); toast('ไปหน้า Tracking (ยังไม่เชื่อม)');
  });
  document.getElementById('goCOD').addEventListener('click', (e)=>{
    e.preventDefault(); toast('ไปหน้า COD (ยังไม่เชื่อม)');
  });
</script>
</body>
</html>
